## 安装truffle
### 设置淘宝源
`
npm config set registry https://registry.npm.taobao.org
`
### 全局安装
`
npm install -g truffle
`
### 本地
`
npm install truffle
`

## 安装Ganache
### 最新版本
`
https://github.com/trufflesuite/ganache/releases
`

## 初始化工程
### 用truffle直接初始化
`
truffle init
`
### 网络问题替代解决方案
git clone https://github.com/truffle-box/bare-box

### 配置网络环境
1. 编辑truffle-config.js，取消development配置节的注释，修改端口为7545(Ganache默认端口)
2. 打开Ganache配置truffle工程位置

## 基本合约工程化开发流程

1. 建立合约, 存放于contracts目录下
2. 编译合约

   `
   truffle compile
   `
3. 编译完成后，合约的ABI等信息存放于build/contracts路径下   
4. 编写迁移脚本

   ```
    var RemarkContract = artifacts.require("RemarkContract");
    module.exports = function(deployer) {
    // deployment steps
    deployer.deploy(RemarkContract, "Test Remark");
    };
   ```

5. 发起部署

    `
    truffle migrate
    `

6. 通过控制台与部署后的合约交互

    `
        truffle console
    `
    ```
        // 获取部署后的合约实例
        let instance = await RedPacket.deployed()
        // 创建红包
        instance. createdRedPacket(10, true, '创建红包', '0x122','0x223', {value: 1000})

        // 获取节点上的账户列表
        let accounts = await web3.eth.getAccounts()
        // 调用合约的call方法读取合约状态
        instance.readRemark(accounts[0], 0)
        instance.createOrUpdateRemark(0, "Remark Test 1")
        instance.createOrUpdateRemark(1, "Remark Test 2")
        instance.approve(accounts[1], 0)
        instance.updateRemarkFor(accounts[0], 1, "Remark update by others", {from: accounts[1]})
    ```

7. 编写单元测试脚本, 脚本位于test文件夹下
8. 执行单元测试

   `
   truffle test
   `

## DAPP开发流程

1. 建立DAPP工程，推荐使用webpack

   `
   truffle unbox webpack
   `

   `
   git clone https://github.com/truffle-box/webpack-box
   `

2. 编写网页代码及逻辑

3. 开启本地调试

   `
   npm run dev
   `

4. 打包发布

   `
   npm run build
   `

## 培训作业

以下DAPP任选一个完成

### 去中心化ERC721钱包DAPP(单合约币)
1. 基于OpenZeppelin合约库发布一个ERC721代币合约
2. 允许合约发布者增发ERC721代币
3. 普通用户可以查询自己持有的代币列表
4. 普通用户可以转赠代币给其它用户

思考题

5. 允许合约发布者吊销已发布的ERC721代币
6. 每个代币拥有一个描述文本和一个外链信息并可以被DAPP显示
7. 将合约发布到Ropsten测试链并发布支持MetaMask的DAPP

### 去中心化ERC20钱包DAPP(多合约币)
1. 基于OpenZeppelin合约库发布一个ERC20代币合约
2. 允许用户自行添加ERC20合约地址
3. 普通用户可以查询自己持有的各代币余额列表
4. 普通用户可以转账各代币给其它用户

思考题

5. 允许合约发布者设置每笔交易产生几枚挖矿收益(代币形式, 自动发送给区块打包者的账户)
6. 转账时允许提交转账备注，并产生转账备注事件
7. 将合约发布到Ropsten测试链并发布支持MetaMask的DAPP