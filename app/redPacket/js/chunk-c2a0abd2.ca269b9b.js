(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c2a0abd2"],{"09d3":function(t,e,a){"use strict";a("68ef"),a("aec8")},"0d55":function(t,e,a){"use strict";a.r(e);var n,c=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"wallet"},[a("div",{staticClass:"content"},["error"!=t.packet.status?a("van-row",{staticClass:"packet-amount-content",attrs:{type:"flex",justify:"center"}},[a("van-col",{staticClass:"packet-content"},[t._v(t._s(t._f("handleStr")(this.packet.owner))+"的红包")])],1):t._e(),a("van-row",{staticClass:"mt_20 packet-amount-msg",attrs:{type:"flex",justify:"center"}},[a("van-col",{staticClass:"packet-amount"},[t._v(t._s(this.packet.description))])],1),"expired"==t.packet.status?a("van-row",{staticClass:"mt_100 packet-amount-msg",attrs:{type:"flex",justify:"center"}},[a("van-col",{staticClass:"packet-amount-text"},[t._v("红包已过期")])],1):"error"==t.packet.status?a("van-row",{staticClass:"mt_40 packet-amount-msg packet-query-text",attrs:{type:"flex",justify:"center"}},[a("van-loading",{staticClass:"packet-query-text",attrs:{color:"#fff"}},[t._v("链上查询中....")])],1):"over"==t.packet.status?a("van-row",{staticClass:"mt_40 packet-amount-msg",attrs:{type:"flex",justify:"center"}},[a("van-col",{staticClass:"packet-amount-text"},[t._v("红包已抢完")])],1):"received"==t.packet.status?a("van-row",{staticClass:"mt_40 packet-amount-msg",attrs:{type:"flex",justify:"center"}},[a("van-col",{staticClass:"packet-amount-text"},[t._v("红包已领取")])],1):"normal"==t.packet.status?a("van-row",{staticClass:"packet-amount-msg",attrs:{type:"flex",justify:"center"},on:{click:t.receivePacket}},[a("van-col",{staticClass:"container packet-image",attrs:{span:"22"}}),a("van-col",{staticClass:"packet-get-text",staticStyle:{"text-align":"center"},attrs:{span:"22"}},[t._v("\n        开\n      ")])],1):a("van-row",{staticClass:"mt_40 packet-amount-msg",attrs:{type:"flex",justify:"center"}},[a("van-col",{staticClass:"packet-amount-text"},[t._v("查询领取情况中...")])],1),"error"!=t.packet.status?a("van-row",{staticClass:"packet-amount-msg",attrs:{type:"flex",justify:"center"},on:{click:t.getPacketDetails}},[a("van-col",{staticClass:"mt_40 packet-details-text",staticStyle:{"text-align":"center"},attrs:{span:24,justify:"center"}},[t._v("查看详情")])],1):t._e()],1)])},s=[],o=(a("e17f"),a("2241")),i=(a("6b54"),a("96cf"),a("3b8d")),r=a("bd86"),l=(a("5246"),a("6b41")),u=(a("61ae"),a("d314")),d=(a("09d3"),a("2d6d")),p=a("58b2"),f={name:"index",components:(n={},Object(r["a"])(n,d["a"].name,d["a"]),Object(r["a"])(n,u["a"].name,u["a"]),Object(r["a"])(n,l["a"].name,l["a"]),n),data:function(){return{account:this.$account,addOpt:[],packet:{key:"0x0",packetAccount:"",addr:"",description:"",isRandom:null,owner:"",remainAmount:0,remainNumber:0,startTime:0,totalAmount:0,totalNumber:0,status:"error"},contract:{address:this.$contract_address,instance:null}}},created:function(){this.initInstance(),this.getkey()},mounted:function(){this.getPacketInfo(this.packet.packetAccount.address),this.perReceiveRedPacket(this),this.watchReceiveEvent()},methods:{getWalletAddress:function(){var t=this;this.$tp.getWalletList(3).then((function(e){console.log("resdata",e);var a=e.wallets.moac;for(var n in a){var c={text:a[n].name+":"+a[n].address,value:a[n].address};t.addOpt.push(c)}}))},initInstance:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.contract.instance=this.$chain3.mc.contract(this.$RedPacketArtifact.abi).at(this.contract.address),window.instance=this.contract.instance;case 2:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),getkey:function(){this.packet.key=this.$route.query.key,this.packet.packetAccount=this.$Web3.eth.accounts.privateKeyToAccount(this.packet.key)},perReceiveRedPacket:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log("perReceiveRedPacket"),e.contract.instance.receiveRedPacket.call(e.packet.packetAccount.address,"0x226ec1f7c89b13b9c8c8cdcf7dca1b5d0d7b8f944411328c9618f73a7a95f378730cdc716d99cde36f6a5217e098b2074cc90445d1cc4e22a06cc9b7eb843c751b",{from:e.account},(function(t,a){if(t)console.log("err"),console.log(t);else{var n=a.toString();console.log("str "+n);var c="0x"+n.slice(10);if(0==n.indexOf("0x08c379a0")){var s=e.$Web3.eth.abi.decodeParameter("string",c);console.log("resStr"),console.log(s),"packetAddr error"==s?(e.packet.status="error",e.getPacketInfo(e.packet.packetAccount.address)):e.packet.status="packet over"==s?"over":"Red packet expired"==s?"expired":"packet have received"==s?"received":"normal"}}}));case 2:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}(),getPacketInfo:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=this,this.contract.instance.queryPacketInfo.call(e,(function(t,e){if(t)console.log("err"),console.log(t);else{var n=e.toString(),c="0x"+n.slice(10);if(0!=n.indexOf("0x08c379a0")){var s=a.$Web3.eth.abi.decodeParameters(a.contract.instance.abi[9].outputs,e);return a.packet.addr=s.addr,a.packet.description=s.description,a.packet.isRandom=s.isRandom,a.packet.owner=s.owner,a.packet.remainAmount=a.$Web3.utils.fromWei(s.remainAmount.toString(10)),a.packet.remainNumber=s.remainNumber,a.packet.startTime=new Date(1e3*s.startTime),a.packet.totalAmount=a.$Web3.utils.fromWei(s.totalAmount.toString(10)),a.packet.totalNumber=s.totalNumber,void console.log(a.packet)}var o=a.$Web3.eth.abi.decodeParameter("string",c);console.log(o)}}));case 2:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),receivePacket:Object(p["a"])((function(){var t=this;if("0x0"!=this.account&&void 0!=this.account){var e=this.contract.instance.receiveRedPacket;console.log(this.account);var a=this.packet.packetAccount.sign(this.$Web3.utils.sha3(this.account)).signature;console.log(a),console.log(this.$Web3.utils.hexToBytes(a));var n=e.getData(this.packet.packetAccount.address,a);console.log(n);var c=this.$chain3.mc.estimateGas({to:this.contract.address,data:n})+21e4;console.log("gasLimit",c);var s={from:this.account,to:this.contract.address,gasPrice:"ios"==this.$system?this.getGasPrice():this.$Web3.utils.toHex(this.getGasPrice()),gasLimit:"ios"==this.$system?c:this.$Web3.utils.toHex(c),data:n,value:"0x0",chainId:"0x63",via:"0x",shardingFlag:"0x0"};console.log("query",s),this.$tp.sendMoacTransaction(s).then((function(e){if(console.log("sendMoacTransaction",e),e.result){console.log("sendMoacTransaction",e);var a=e.data,n=t.$chain3.mc.getTransactionReceipt(a);n&&console.log("receipt:",n),t.$toast("操作成功"),t.getPacketDetails()}if(!e.result)return"replacement transaction underpriced"==e.data?(t.$toast("其他交易正在确认中，请稍后！"),!1):(t.$toast(e.data),!1)})).catch((function(t){console.log("error"),console.log(t)}))}else o["a"].alert({message:"请使用moac钱包地址"}).then((function(){}))}),2e3),getGasPrice:function(){var t=this.$chain3.mc.gasPrice;return t.toString()},getPacketDetails:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.$router.push({path:"/packet-details",query:{addr:this.packet.addr,account:this.account}});case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),watchReceiveEvent:function(){var t=this;this.contract.instance.CreateRedPacketEvent({packetAddr:this.packet.addr},{fromBlock:"latest",toBlock:"latest"},(function(e,a){e||(console.log("res"),console.log(a),setTimeout((function(){t.getPacketInfo(t.packet.packetAccount.address),t.perReceiveRedPacket(t)}),3e3))}))}},filters:{handleStr:function(t){if(t.length>12){var e=t.substring(0,8),a=t.substr(t.length-4,4),n=e+"..."+a;return n}return t}}},h=f,v=(a("3cd4"),a("2877")),m=Object(v["a"])(h,c,s,!1,null,"88449db6",null);e["default"]=m.exports},"2d6d":function(t,e,a){"use strict";var n=a("d282"),c=a("a142"),s=a("a8c1"),o=a("9884"),i=a("b222"),r=Object(n["a"])("dropdown-menu"),l=r[0],u=r[1];e["a"]=l({mixins:[Object(o["b"])("vanDropdownMenu"),Object(i["a"])({event:"click",method:"onClickOutside"})],props:{zIndex:[Number,String],activeColor:String,overlay:{type:Boolean,default:!0},duration:{type:[Number,String],default:.2},direction:{type:String,default:"down"},closeOnClickOverlay:{type:Boolean,default:!0}},data:function(){return{offset:0}},computed:{scroller:function(){return Object(s["c"])(this.$el)},opened:function(){return this.children.some((function(t){return t.showWrapper}))},barStyle:function(){if(this.opened&&Object(c["b"])(this.zIndex))return{zIndex:1+this.zIndex}}},methods:{updateOffset:function(){if(this.$refs.bar){var t=this.$refs.bar.getBoundingClientRect();"down"===this.direction?this.offset=t.bottom:this.offset=window.innerHeight-t.top}},toggleItem:function(t){this.children.forEach((function(e,a){a===t?e.toggle():e.showPopup&&e.toggle(!1,{immediate:!0})}))},onClickOutside:function(){this.children.forEach((function(t){t.toggle(!1)}))}},render:function(){var t=this,e=arguments[0],a=this.children.map((function(a,n){return e("div",{attrs:{role:"button",tabindex:a.disabled?-1:0},class:u("item",{disabled:a.disabled}),on:{click:function(){a.disabled||t.toggleItem(n)}}},[e("span",{class:[u("title",{active:a.showPopup,down:a.showPopup===("down"===t.direction)}),a.titleClass],style:{color:a.showPopup?t.activeColor:""}},[e("div",{class:"van-ellipsis"},[a.slots("title")||a.displayTitle])])])}));return e("div",{class:u()},[e("div",{ref:"bar",style:this.barStyle,class:u("bar",{opened:this.opened})},[a]),this.slots("default")])}})},"3cd4":function(t,e,a){"use strict";var n=a("8446"),c=a.n(n);c.a},"454f":function(t,e,a){a("46a7");var n=a("584a").Object;t.exports=function(t,e,a){return n.defineProperty(t,e,a)}},"46a7":function(t,e,a){var n=a("63b6");n(n.S+n.F*!a("8e60"),"Object",{defineProperty:a("d9f6").f})},"58b2":function(t,e,a){"use strict";function n(t,e){var a,n,c,s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=function(){return setTimeout((function(){a=null,s||(t.apply(n,c),n=c=null)}),e)},i=function(){if(a)clearTimeout(a),a=o();else{a=o();for(var e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];s?t.apply(this,i):(n=this,c=i)}};return i.cancel=function(){clearTimeout(a),a=null},i}a.d(e,"a",(function(){return n}))},"61ae":function(t,e,a){"use strict";a("68ef"),a("a71a"),a("9d70"),a("3743"),a("1a04"),a("4d75"),a("b2cc")},8446:function(t,e,a){},"85f2":function(t,e,a){t.exports=a("454f")},aec8:function(t,e,a){},b2cc:function(t,e,a){},bd86:function(t,e,a){"use strict";a.d(e,"a",(function(){return s}));var n=a("85f2"),c=a.n(n);function s(t,e,a){return e in t?c()(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}},d314:function(t,e,a){"use strict";var n=a("d282"),c=a("1325"),s=a("1421"),o=a("9884"),i=a("7744"),r=a("ad06"),l=a("e41f"),u=Object(n["a"])("dropdown-item"),d=u[0],p=u[1];e["a"]=d({mixins:[Object(s["a"])({ref:"wrapper"}),Object(o["a"])("vanDropdownMenu")],props:{value:null,title:String,disabled:Boolean,titleClass:String,options:{type:Array,default:function(){return[]}}},data:function(){return{transition:!0,showPopup:!1,showWrapper:!1}},computed:{displayTitle:function(){var t=this;if(this.title)return this.title;var e=this.options.filter((function(e){return e.value===t.value}));return e.length?e[0].text:""}},watch:{showPopup:function(t){this.bindScroll(t)}},beforeCreate:function(){var t=this,e=function(e){return function(){return t.$emit(e)}};this.onOpen=e("open"),this.onClose=e("close"),this.onOpened=e("opened")},methods:{toggle:function(t,e){void 0===t&&(t=!this.showPopup),void 0===e&&(e={}),t!==this.showPopup&&(this.transition=!e.immediate,this.showPopup=t,t&&(this.parent.updateOffset(),this.showWrapper=!0))},bindScroll:function(t){var e=this.parent.scroller,a=t?c["b"]:c["a"];a(e,"scroll",this.onScroll,!0)},onScroll:function(){this.parent.updateOffset()},onClickWrapper:function(t){this.getContainer&&t.stopPropagation()}},render:function(){var t=this,e=arguments[0],a=this.parent,n=a.zIndex,c=a.offset,s=a.overlay,o=a.duration,u=a.direction,d=a.activeColor,f=a.closeOnClickOverlay,h=this.options.map((function(a){var n=a.value===t.value;return e(i["a"],{attrs:{clickable:!0,icon:a.icon,title:a.text},key:a.value,class:p("option",{active:n}),style:{color:n?d:""},on:{click:function(){t.showPopup=!1,a.value!==t.value&&(t.$emit("input",a.value),t.$emit("change",a.value))}}},[n&&e(r["a"],{class:p("icon"),attrs:{color:d,name:"success"}})])})),v={zIndex:n};return"down"===u?v.top=c+"px":v.bottom=c+"px",e("div",[e("div",{directives:[{name:"show",value:this.showWrapper}],ref:"wrapper",style:v,class:p([u]),on:{click:this.onClickWrapper}},[e(l["a"],{attrs:{overlay:s,position:"down"===u?"top":"bottom",duration:this.transition?o:0,closeOnClickOverlay:f,overlayStyle:{position:"absolute"}},class:p("content"),on:{open:this.onOpen,close:this.onClose,opened:this.onOpened,closed:function(){t.showWrapper=!1,t.$emit("closed")}},model:{value:t.showPopup,callback:function(e){t.showPopup=e}}},[h,this.slots("default")])])])}})}}]);
//# sourceMappingURL=chunk-c2a0abd2.ca269b9b.js.map