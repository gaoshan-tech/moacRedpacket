(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7e382575"],{"06e9":function(t,e,n){},"09d3":function(t,e,n){"use strict";n("68ef"),n("aec8")},"0d55":function(t,e,n){"use strict";n.r(e);var a,s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",["error"!=t.packet.status?n("van-row",{staticClass:"packet-amount-content",attrs:{type:"flex",justify:"center"}},[n("van-col",{staticClass:"packet-content"},[t._v(t._s(t._f("handleStr")(this.packet.owner))+"的红包")])],1):t._e(),n("van-row",{staticClass:"mt_20 packet-amount-msg",attrs:{type:"flex",justify:"center"}},[n("van-col",{staticClass:"packet-amount"},[t._v(t._s(this.packet.description))])],1),"expired"==t.packet.status?n("van-row",{staticClass:"mt_40 packet-amount-msg",attrs:{type:"flex",justify:"center"}},[n("van-col",{staticClass:"packet-amount-text"},[t._v("红包已过期")])],1):"error"==t.packet.status?n("van-row",{staticClass:"mt_40 packet-amount-msg",attrs:{type:"flex",justify:"center"}},[n("van-col",{staticClass:"packet-amount-text"},[t._v("链上查询中...")])],1):"over"==t.packet.status?n("van-row",{staticClass:"mt_40 packet-amount-msg",attrs:{type:"flex",justify:"center"}},[n("van-col",{staticClass:"packet-amount-text"},[t._v("红包已抢完")])],1):"received"==t.packet.status?n("van-row",{staticClass:"mt_40 packet-amount-msg",attrs:{type:"flex",justify:"center"}},[n("van-col",{staticClass:"packet-amount-text"},[t._v("红包已领取")])],1):n("van-row",{staticClass:"packet-amount-msg",attrs:{type:"flex",justify:"center"},on:{click:t.receivePacket}},[n("van-col",{staticClass:"container packet-image",attrs:{span:"22"}}),n("van-col",{staticClass:"packet-get-text",staticStyle:{"text-align":"center"},attrs:{span:"22"}},[t._v("\n      开\n    ")])],1),"error"!=t.packet.status?n("van-row",{staticClass:"packet-amount-msg",attrs:{type:"flex",justify:"center"},on:{click:t.getPacketDetails}},[n("van-col",{staticClass:"mt_40 packet-details-text",staticStyle:{"text-align":"center"},attrs:{span:24,justify:"center"}},[t._v("查看详情")])],1):t._e()],1)},c=[],o=(n("e17f"),n("2241")),i=(n("6b54"),n("96cf"),n("3b8d")),r=n("bd86"),u=(n("5246"),n("6b41")),l=(n("61ae"),n("d314")),p=(n("09d3"),n("2d6d")),d={name:"index",components:(a={},Object(r["a"])(a,p["a"].name,p["a"]),Object(r["a"])(a,l["a"].name,l["a"]),Object(r["a"])(a,u["a"].name,u["a"]),a),data:function(){return{account:this.$account,addOpt:[],packet:{key:"0x0",packetAccount:"",addr:"",description:"",isRandom:null,owner:"",remainAmount:0,remainNumber:0,startTime:0,totalAmount:0,totalNumber:0,status:"normal"},contract:{address:this.$contract_address,instance:null}}},created:function(){this.initInstance(),this.getkey(),this.getWalletAddress()},mounted:function(){this.getPacketInfo(this.packet.packetAccount.address),this.perReceiveRedPacket(this),this.watchReceiveEvent()},methods:{getWalletAddress:function(){var t=this;this.$tp.getWalletList(3).then((function(e){console.log("resdata",e);var n=e.wallets.moac;for(var a in n){var s={text:n[a].name+":"+n[a].address,value:n[a].address};t.addOpt.push(s)}}))},initInstance:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.contract.instance=this.$chain3.mc.contract(this.$RedPacketArtifact.abi).at(this.contract.address),window.instance=this.contract.instance;case 2:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),getkey:function(){this.packet.key=this.$route.query.key,this.packet.packetAccount=this.$Web3.eth.accounts.privateKeyToAccount(this.packet.key)},perReceiveRedPacket:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.contract.instance.receiveRedPacket.call(e.packet.packetAccount.address,"0x0",{from:e.account},(function(t,n){if(t)console.log("err"),console.log(t);else{var a=n.toString();console.log("str "+a);var s="0x"+a.slice(10);if(0==a.indexOf("0x08c379a0")){var c=e.$Web3.eth.abi.decodeParameter("string",s);console.log(c),"packetAddr error"==c?(e.packet.status="error",e.getPacketInfo(e.packet.packetAccount.address)):"packet over"==c?e.packet.status="over":"Red packet expired"==c?e.packet.status="expired":"packet have received"==c&&(e.packet.status="received")}}}));case 1:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}(),getPacketInfo:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:n=this,this.contract.instance.queryPacketInfo.call(e,(function(t,e){if(t)console.log("err"),console.log(t);else{var a=e.toString(),s="0x"+a.slice(10);if(0!=a.indexOf("0x08c379a0")){var c=n.$Web3.eth.abi.decodeParameters(n.contract.instance.abi[9].outputs,e);return n.packet.addr=c.addr,n.packet.description=c.description,n.packet.isRandom=c.isRandom,n.packet.owner=c.owner,n.packet.remainAmount=n.$Web3.utils.fromWei(c.remainAmount.toString()),n.packet.remainNumber=c.remainNumber,n.packet.startTime=new Date(1e3*c.startTime),n.packet.totalAmount=n.$Web3.utils.fromWei(c.totalAmount.toString()),n.packet.totalNumber=c.totalNumber,void console.log(n.packet)}var o=n.$Web3.eth.abi.decodeParameter("string",s);console.log(o)}}));case 2:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),receivePacket:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){var e,n,a,s,c,i=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if("0x0"!=this.account&&void 0!=this.account){t.next=3;break}return o["a"].alert({message:"请选择正确的钱包地址"}).then((function(){})),t.abrupt("return");case 3:this,e=this.contract.instance.receiveRedPacket,console.log(this.account),n=this.packet.packetAccount.sign(this.$Web3.utils.sha3(this.account)).signature,console.log(n),console.log(this.$Web3.utils.hexToBytes(n)),a=e.getData(this.packet.packetAccount.address,n),console.log(a),s=this.$chain3.mc.estimateGas({to:this.contract.address,data:a})+21e4,console.log("gasLimit",s),c={from:this.account,to:this.contract.address,gasPrice:"ios"==this.$system?this.getGasPrice():this.$Web3.utils.toHex(this.getGasPrice()),gasLimit:"ios"==this.$system?s:this.$Web3.utils.toHex(s),data:a,value:"0x0",chainId:"0x63",via:"0x",shardingFlag:"0x0"},console.log("query",c),this.$tp.sendMoacTransaction(c).then((function(t){if(console.log("sendMoacTransaction",t),t.result){console.log("sendMoacTransaction",t);var e=t.data,n=i.$chain3.mc.getTransactionReceipt(e);n&&console.log("receipt:",n),i.$toast("操作成功"),i.getPacketDetails()}if(!t.result)return"replacement transaction underpriced"==t.data?(i.$toast("其他交易正在确认中，请稍后！"),!1):(i.$toast(t.data),!1)})).catch((function(t){console.log("error"),console.log(t)}));case 16:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),getGasPrice:function(){var t=this.$chain3.mc.gasPrice;return t.toString()},getPacketDetails:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.$router.push({path:"/packet-details",query:{addr:this.packet.addr,account:this.account}});case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),watchReceiveEvent:function(){var t=this;this.contract.instance.CreateRedPacketEvent({packetAddr:this.packet.addr},{fromBlock:"latest",toBlock:"latest"},(function(e,n){e||(console.log("res"),console.log(n),setTimeout((function(){t.getPacketInfo(t.packet.packetAccount.address),t.packet.status="normal"}),3e3))}))}},filters:{handleStr:function(t){if(t.length>12){var e=t.substring(0,8),n=t.substr(t.length-4,4),a=e+"..."+n;return a}return t}}},h=d,f=(n("c229"),n("2877")),m=Object(f["a"])(h,s,c,!1,null,"4ba2ec84",null);e["default"]=m.exports},"2d6d":function(t,e,n){"use strict";var a=n("d282"),s=n("a142"),c=n("a8c1"),o=n("9884"),i=n("b222"),r=Object(a["a"])("dropdown-menu"),u=r[0],l=r[1];e["a"]=u({mixins:[Object(o["b"])("vanDropdownMenu"),Object(i["a"])({event:"click",method:"onClickOutside"})],props:{zIndex:[Number,String],activeColor:String,overlay:{type:Boolean,default:!0},duration:{type:[Number,String],default:.2},direction:{type:String,default:"down"},closeOnClickOverlay:{type:Boolean,default:!0}},data:function(){return{offset:0}},computed:{scroller:function(){return Object(c["c"])(this.$el)},opened:function(){return this.children.some((function(t){return t.showWrapper}))},barStyle:function(){if(this.opened&&Object(s["b"])(this.zIndex))return{zIndex:1+this.zIndex}}},methods:{updateOffset:function(){if(this.$refs.bar){var t=this.$refs.bar.getBoundingClientRect();"down"===this.direction?this.offset=t.bottom:this.offset=window.innerHeight-t.top}},toggleItem:function(t){this.children.forEach((function(e,n){n===t?e.toggle():e.showPopup&&e.toggle(!1,{immediate:!0})}))},onClickOutside:function(){this.children.forEach((function(t){t.toggle(!1)}))}},render:function(){var t=this,e=arguments[0],n=this.children.map((function(n,a){return e("div",{attrs:{role:"button",tabindex:n.disabled?-1:0},class:l("item",{disabled:n.disabled}),on:{click:function(){n.disabled||t.toggleItem(a)}}},[e("span",{class:[l("title",{active:n.showPopup,down:n.showPopup===("down"===t.direction)}),n.titleClass],style:{color:n.showPopup?t.activeColor:""}},[e("div",{class:"van-ellipsis"},[n.slots("title")||n.displayTitle])])])}));return e("div",{class:l()},[e("div",{ref:"bar",style:this.barStyle,class:l("bar",{opened:this.opened})},[n]),this.slots("default")])}})},"454f":function(t,e,n){n("46a7");var a=n("584a").Object;t.exports=function(t,e,n){return a.defineProperty(t,e,n)}},"46a7":function(t,e,n){var a=n("63b6");a(a.S+a.F*!n("8e60"),"Object",{defineProperty:n("d9f6").f})},"61ae":function(t,e,n){"use strict";n("68ef"),n("a71a"),n("9d70"),n("3743"),n("1a04"),n("4d75"),n("b2cc")},"85f2":function(t,e,n){t.exports=n("454f")},aec8:function(t,e,n){},b2cc:function(t,e,n){},bd86:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var a=n("85f2"),s=n.n(a);function c(t,e,n){return e in t?s()(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}},c229:function(t,e,n){"use strict";var a=n("06e9"),s=n.n(a);s.a},d314:function(t,e,n){"use strict";var a=n("d282"),s=n("1325"),c=n("1421"),o=n("9884"),i=n("7744"),r=n("ad06"),u=n("e41f"),l=Object(a["a"])("dropdown-item"),p=l[0],d=l[1];e["a"]=p({mixins:[Object(c["a"])({ref:"wrapper"}),Object(o["a"])("vanDropdownMenu")],props:{value:null,title:String,disabled:Boolean,titleClass:String,options:{type:Array,default:function(){return[]}}},data:function(){return{transition:!0,showPopup:!1,showWrapper:!1}},computed:{displayTitle:function(){var t=this;if(this.title)return this.title;var e=this.options.filter((function(e){return e.value===t.value}));return e.length?e[0].text:""}},watch:{showPopup:function(t){this.bindScroll(t)}},beforeCreate:function(){var t=this,e=function(e){return function(){return t.$emit(e)}};this.onOpen=e("open"),this.onClose=e("close"),this.onOpened=e("opened")},methods:{toggle:function(t,e){void 0===t&&(t=!this.showPopup),void 0===e&&(e={}),t!==this.showPopup&&(this.transition=!e.immediate,this.showPopup=t,t&&(this.parent.updateOffset(),this.showWrapper=!0))},bindScroll:function(t){var e=this.parent.scroller,n=t?s["b"]:s["a"];n(e,"scroll",this.onScroll,!0)},onScroll:function(){this.parent.updateOffset()},onClickWrapper:function(t){this.getContainer&&t.stopPropagation()}},render:function(){var t=this,e=arguments[0],n=this.parent,a=n.zIndex,s=n.offset,c=n.overlay,o=n.duration,l=n.direction,p=n.activeColor,h=n.closeOnClickOverlay,f=this.options.map((function(n){var a=n.value===t.value;return e(i["a"],{attrs:{clickable:!0,icon:n.icon,title:n.text},key:n.value,class:d("option",{active:a}),style:{color:a?p:""},on:{click:function(){t.showPopup=!1,n.value!==t.value&&(t.$emit("input",n.value),t.$emit("change",n.value))}}},[a&&e(r["a"],{class:d("icon"),attrs:{color:p,name:"success"}})])})),m={zIndex:a};return"down"===l?m.top=s+"px":m.bottom=s+"px",e("div",[e("div",{directives:[{name:"show",value:this.showWrapper}],ref:"wrapper",style:m,class:d([l]),on:{click:this.onClickWrapper}},[e(u["a"],{attrs:{overlay:c,position:"down"===l?"top":"bottom",duration:this.transition?o:0,closeOnClickOverlay:h,overlayStyle:{position:"absolute"}},class:d("content"),on:{open:this.onOpen,close:this.onClose,opened:this.onOpened,closed:function(){t.showWrapper=!1,t.$emit("closed")}},model:{value:t.showPopup,callback:function(e){t.showPopup=e}}},[f,this.slots("default")])])])}})}}]);
//# sourceMappingURL=chunk-7e382575.5d697891.js.map